#!/usr/bin/env coffee

fs         = require 'fs-plus'
Handlebars = require 'handlebars'
path       = require 'path'

Handlebars.registerHelper 'cash_graph',   require('../src/cash-graph')
Handlebars.registerHelper 'cash_map',   require('../src/cash-map')
Handlebars.registerHelper 'eps_graph',    require('../src/eps-graph')
Handlebars.registerHelper 'google_map',   require('../src/google-map')
Handlebars.registerHelper 'profit_graph', require('../src/profit-graph')

companyTemplate = Handlebars.compile(fs.readFileSync(path.resolve(__dirname, '..', 'company', 'company.hbs'), 'utf8'))

buildPage = (symbolPath) ->
  symbol = path.basename(symbolPath, path.extname(symbolPath))
  company = JSON.parse(fs.readFileSync(symbolPath, 'utf8'))
  fs.writeFileSync(path.resolve(__dirname, '..', 'company', "#{symbol}.html"), companyTemplate(company))

fs.listSync(path.resolve(__dirname, '..', 'company'), ['.json']).forEach(buildPage)

indexTemplate = Handlebars.compile(fs.readFileSync(path.resolve(__dirname, '..', 'index.hbs'), 'utf8'))
fs.writeFileSync(path.resolve(__dirname, '..', "index.html"), indexTemplate({}))
